import{Q as Y,M as E,R as ye,L as we,S as be,l as y,a as xe,P as ve,G as h,b as Se,c as ze,D as Ie,F as Fe,U as Ce,g as ke,d as W,C as _,B as se}from"./index-BpW7j5_2.js";se();se();var Me="ENTRIES",ne="KEYS",re="VALUES",b="",oe=class{constructor(e,t){let i=e._tree,s=Array.from(i.keys());this.set=e,this._type=t,this._path=s.length>0?[{node:i,keys:s}]:[]}next(){let e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};let{node:e,keys:t}=z(this._path);if(z(t)===b)return{done:!1,value:this.result()};let i=e.get(z(t));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;let e=z(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>z(e)).filter(e=>e!==b).join("")}value(){return z(this._path).node.get(b)}result(){switch(this._type){case re:return this.value();case ne:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}};h(oe,"TreeIterator");var B=oe,z=h(r=>r[r.length-1],"last$1"),Ae=h((r,e,t)=>{let i=new Map;if(e===void 0)return i;let s=e.length+1,n=s+t,o=new Uint8Array(n*s).fill(t+1);for(let l=0;l<s;++l)o[l]=l;for(let l=1;l<n;++l)o[l*s]=l;return le(r,e,t,i,o,1,s,""),i},"fuzzySearch"),le=h((r,e,t,i,s,n,o,l)=>{let a=n*o;e:for(let d of r.keys())if(d===b){let u=s[a-1];u<=t&&i.set(l,[r.get(d),u])}else{let u=n;for(let f=0;f<d.length;++f,++u){let c=d[f],p=o*u,w=p-o,m=s[p],g=Math.max(0,u-t-1),v=Math.min(o-1,u+t);for(let x=g;x<v;++x){let D=c!==e[x],j=s[w+x]+ +D,C=s[w+x+1]+1,S=s[p+x]+1,I=s[p+x+1]=Math.min(j,C,S);I<m&&(m=I)}if(m>t)continue e}le(r.get(d),e,t,i,s,u,o,l+d)}},"recurse"),ae=class F{constructor(e=new Map,t=""){this._size=void 0,this._tree=e,this._prefix=t}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");let[t,i]=V(this._tree,e.slice(this._prefix.length));if(t===void 0){let[s,n]=H(i);for(let o of s.keys())if(o!==b&&o.startsWith(n)){let l=new Map;return l.set(o.slice(n.length),s.get(o)),new F(l,e)}}return new F(t,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,Le(this._tree,e)}entries(){return new B(this,Me)}forEach(e){for(let[t,i]of this)e(t,i,this)}fuzzyGet(e,t){return Ae(this._tree,e,t)}get(e){let t=$(this._tree,e);return t!==void 0?t.get(b):void 0}has(e){let t=$(this._tree,e);return t!==void 0&&t.has(b)}keys(){return new B(this,ne)}set(e,t){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,q(this._tree,e).set(b,t),this}get size(){if(this._size)return this._size;this._size=0;let e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let i=q(this._tree,e);return i.set(b,t(i.get(b))),this}fetch(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let i=q(this._tree,e),s=i.get(b);return s===void 0&&i.set(b,s=t()),s}values(){return new B(this,re)}[Symbol.iterator](){return this.entries()}static from(e){let t=new F;for(let[i,s]of e)t.set(i,s);return t}static fromObject(e){return F.from(Object.entries(e))}};h(ae,"SearchableMap");var R=ae,V=h((r,e,t=[])=>{if(e.length===0||r==null)return[r,t];for(let i of r.keys())if(i!==b&&e.startsWith(i))return t.push([r,i]),V(r.get(i),e.slice(i.length),t);return t.push([r,e]),V(void 0,"",t)},"trackDown"),$=h((r,e)=>{if(e.length===0||r==null)return r;for(let t of r.keys())if(t!==b&&e.startsWith(t))return $(r.get(t),e.slice(t.length))},"lookup"),q=h((r,e)=>{let t=e.length;e:for(let i=0;r&&i<t;){for(let n of r.keys())if(n!==b&&e[i]===n[0]){let o=Math.min(t-i,n.length),l=1;for(;l<o&&e[i+l]===n[l];)++l;let a=r.get(n);if(l===n.length)r=a;else{let d=new Map;d.set(n.slice(l),a),r.set(e.slice(i,i+l),d),r.delete(n),r=d}i+=l;continue e}let s=new Map;return r.set(e.slice(i),s),s}return r},"createPath"),Le=h((r,e)=>{let[t,i]=V(r,e);if(t!==void 0){if(t.delete(b),t.size===0)ue(i);else if(t.size===1){let[s,n]=t.entries().next().value;de(i,s,n)}}},"remove"),ue=h(r=>{if(r.length===0)return;let[e,t]=H(r);if(e.delete(t),e.size===0)ue(r.slice(0,-1));else if(e.size===1){let[i,s]=e.entries().next().value;i!==b&&de(r.slice(0,-1),i,s)}},"cleanup"),de=h((r,e,t)=>{if(r.length===0)return;let[i,s]=H(r);i.set(s+e,t),i.delete(s)},"merge"),H=h(r=>r[r.length-1],"last"),K="or",ce="and",Te="and_not",he=class A{constructor(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');let t=e.autoVacuum==null||e.autoVacuum===!0?J:e.autoVacuum;this._options=W(_(_({},N),e),{autoVacuum:t,searchOptions:_(_({},Z),e.searchOptions||{}),autoSuggestOptions:_(_({},Ee),e.autoSuggestOptions||{})}),this._index=new R,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=U,this.addFields(this._options.fields)}add(e){let{extractField:t,tokenize:i,processTerm:s,fields:n,idField:o}=this._options,l=t(e,o);if(l==null)throw new Error('MiniSearch: document does not have ID field "'.concat(o,'"'));if(this._idToShortId.has(l))throw new Error("MiniSearch: duplicate ID ".concat(l));let a=this.addDocumentId(l);this.saveStoredFields(a,e);for(let d of n){let u=t(e,d);if(u==null)continue;let f=i(u.toString(),d),c=this._fieldIds[d],p=new Set(f).size;this.addFieldLength(a,c,this._documentCount-1,p);for(let w of f){let m=s(w,d);if(Array.isArray(m))for(let g of m)this.addTerm(c,a,g);else m&&this.addTerm(c,a,m)}}}addAll(e){for(let t of e)this.add(t)}addAllAsync(e,t={}){let{chunkSize:i=10}=t,s={chunk:[],promise:Promise.resolve()},{chunk:n,promise:o}=e.reduce(({chunk:l,promise:a},d,u)=>(l.push(d),(u+1)%i===0?{chunk:[],promise:a.then(()=>new Promise(f=>setTimeout(f,0))).then(()=>this.addAll(l))}:{chunk:l,promise:a}),s);return o.then(()=>this.addAll(n))}remove(e){let{tokenize:t,processTerm:i,extractField:s,fields:n,idField:o}=this._options,l=s(e,o);if(l==null)throw new Error('MiniSearch: document does not have ID field "'.concat(o,'"'));let a=this._idToShortId.get(l);if(a==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(l,": it is not in the index"));for(let d of n){let u=s(e,d);if(u==null)continue;let f=t(u.toString(),d),c=this._fieldIds[d],p=new Set(f).size;this.removeFieldLength(a,c,this._documentCount,p);for(let w of f){let m=i(w,d);if(Array.isArray(m))for(let g of m)this.removeTerm(c,a,g);else m&&this.removeTerm(c,a,m)}}this._storedFields.delete(a),this._documentIds.delete(a),this._idToShortId.delete(l),this._fieldLength.delete(a),this._documentCount-=1}removeAll(e){if(e)for(let t of e)this.remove(t);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new R,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){let t=this._idToShortId.get(e);if(t==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(t),this._storedFields.delete(t),(this._fieldLength.get(t)||[]).forEach((i,s)=>{this.removeFieldLength(t,s,this._documentCount,i)}),this._fieldLength.delete(t),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;let{minDirtFactor:e,minDirtCount:t,batchSize:i,batchWait:s}=this._options.autoVacuum;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:t,minDirtFactor:e})}discardAll(e){let t=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(let i of e)this.discard(i)}finally{this._options.autoVacuum=t}this.maybeAutoVacuum()}replace(e){let{idField:t,extractField:i}=this._options,s=i(e,t);this.discard(s),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,t){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{let i=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=U,this.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}async performVacuuming(e,t){let i=this._dirtCount;if(this.vacuumConditionsMet(t)){let s=e.batchSize||Q.batchSize,n=e.batchWait||Q.batchWait,o=1;for(let[l,a]of this._index){for(let[d,u]of a)for(let[f]of u)this._documentIds.has(f)||(u.size<=1?a.delete(d):u.delete(f));this._index.get(l).size===0&&this._index.delete(l),o%s===0&&await new Promise(d=>setTimeout(d,n)),o+=1}this._dirtCount-=i}await null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:t,minDirtFactor:i}=e;return t=t||J.minDirtCount,i=i||J.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=i}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){let t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)}search(e,t={}){let{searchOptions:i}=this._options,s=_(_({},i),t),n=this.executeQuery(e,t),o=[];for(let[l,{score:a,terms:d,match:u}]of n){let f=d.length||1,c={id:this._documentIds.get(l),score:a*f,terms:Object.keys(u),queryTerms:d,match:u};Object.assign(c,this._storedFields.get(l)),(s.filter==null||s.filter(c))&&o.push(c)}return e===A.wildcard&&s.boostDocument==null||o.sort(ee),o}autoSuggest(e,t={}){t=_(_({},this._options.autoSuggestOptions),t);let i=new Map;for(let{score:n,terms:o}of this.search(e,t)){let l=o.join(" "),a=i.get(l);a!=null?(a.score+=n,a.count+=1):i.set(l,{score:n,terms:o,count:1})}let s=[];for(let[n,{score:o,terms:l,count:a}]of i)s.push({suggestion:n,terms:l,score:o/a});return s.sort(ee),s}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)}static async loadJSONAsync(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),t)}static getDefault(e){if(N.hasOwnProperty(e))return P(N,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))}static loadJS(e,t){let{index:i,documentIds:s,fieldLength:n,storedFields:o,serializationVersion:l}=e,a=this.instantiateMiniSearch(e,t);a._documentIds=k(s),a._fieldLength=k(n),a._storedFields=k(o);for(let[d,u]of a._documentIds)a._idToShortId.set(u,d);for(let[d,u]of i){let f=new Map;for(let c of Object.keys(u)){let p=u[c];l===1&&(p=p.ds),f.set(parseInt(c,10),k(p))}a._index.set(d,f)}return a}static async loadJSAsync(e,t){let{index:i,documentIds:s,fieldLength:n,storedFields:o,serializationVersion:l}=e,a=this.instantiateMiniSearch(e,t);a._documentIds=await M(s),a._fieldLength=await M(n),a._storedFields=await M(o);for(let[u,f]of a._documentIds)a._idToShortId.set(f,u);let d=0;for(let[u,f]of i){let c=new Map;for(let p of Object.keys(f)){let w=f[p];l===1&&(w=w.ds),c.set(parseInt(p,10),await M(w))}++d%1e3===0&&await fe(0),a._index.set(u,c)}return a}static instantiateMiniSearch(e,t){let{documentCount:i,nextId:s,fieldIds:n,averageFieldLength:o,dirtCount:l,serializationVersion:a}=e;if(a!==1&&a!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");let d=new A(t);return d._documentCount=i,d._nextId=s,d._idToShortId=new Map,d._fieldIds=n,d._avgFieldLength=o,d._dirtCount=l||0,d._index=new R,d}executeQuery(e,t={}){if(e===A.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){let u=W(_(_({},t),e),{queries:void 0}),f=e.queries.map(c=>this.executeQuery(c,u));return this.combineResults(f,u.combineWith)}let{tokenize:i,processTerm:s,searchOptions:n}=this._options,o=_(_({tokenize:i,processTerm:s},n),t),{tokenize:l,processTerm:a}=o,d=l(e).flatMap(u=>a(u)).filter(u=>!!u).map(je(o)).map(u=>this.executeQuerySpec(u,o));return this.combineResults(d,o.combineWith)}executeQuerySpec(e,t){let i=_(_({},this._options.searchOptions),t),s=(i.fields||this._options.fields).reduce((m,g)=>W(_({},m),{[g]:P(i.boost,g)||1}),{}),{boostDocument:n,weights:o,maxFuzzy:l,bm25:a}=i,{fuzzy:d,prefix:u}=_(_({},Z.weights),o),f=this._index.get(e.term),c=this.termResults(e.term,e.term,1,e.termBoost,f,s,n,a),p,w;if(e.prefix&&(p=this._index.atPrefix(e.term)),e.fuzzy){let m=e.fuzzy===!0?.2:e.fuzzy,g=m<1?Math.min(l,Math.round(e.term.length*m)):m;g&&(w=this._index.fuzzyGet(e.term,g))}if(p)for(let[m,g]of p){let v=m.length-e.term.length;if(!v)continue;w==null||w.delete(m);let x=u*m.length/(m.length+.3*v);this.termResults(e.term,m,x,e.termBoost,g,s,n,a,c)}if(w)for(let m of w.keys()){let[g,v]=w.get(m);if(!v)continue;let x=d*m.length/(m.length+v);this.termResults(e.term,m,x,e.termBoost,g,s,n,a,c)}return c}executeWildcardQuery(e){let t=new Map,i=_(_({},this._options.searchOptions),e);for(let[s,n]of this._documentIds){let o=i.boostDocument?i.boostDocument(n,"",this._storedFields.get(s)):1;t.set(s,{score:o,terms:[],match:{}})}return t}combineResults(e,t=K){if(e.length===0)return new Map;let i=t.toLowerCase(),s=Oe[i];if(!s)throw new Error("Invalid combination operator: ".concat(t));return e.reduce(s)||new Map}toJSON(){let e=[];for(let[t,i]of this._index){let s={};for(let[n,o]of i)s[n]=Object.fromEntries(o);e.push([t,s])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,t,i,s,n,o,l,a,d=new Map){if(n==null)return d;for(let u of Object.keys(o)){let f=o[u],c=this._fieldIds[u],p=n.get(c);if(p==null)continue;let w=p.size,m=this._avgFieldLength[c];for(let g of p.keys()){if(!this._documentIds.has(g)){this.removeTerm(c,g,t),w-=1;continue}let v=l?l(this._documentIds.get(g),t,this._storedFields.get(g)):1;if(!v)continue;let x=p.get(g),D=this._fieldLength.get(g)[c],j=De(x,w,this._documentCount,D,m,a),C=i*s*f*v*j,S=d.get(g);if(S){S.score+=C,We(S.terms,e);let I=P(S.match,t);I?I.push(u):S.match[t]=[u]}else d.set(g,{score:C,terms:[e],match:{[t]:[u]}})}}return d}addTerm(e,t,i){let s=this._index.fetch(i,te),n=s.get(e);if(n==null)n=new Map,n.set(t,1),s.set(e,n);else{let o=n.get(t);n.set(t,(o||0)+1)}}removeTerm(e,t,i){if(!this._index.has(i)){this.warnDocumentChanged(t,e,i);return}let s=this._index.fetch(i,te),n=s.get(e);n==null||n.get(t)==null?this.warnDocumentChanged(t,e,i):n.get(t)<=1?n.size<=1?s.delete(e):n.delete(t):n.set(t,n.get(t)-1),this._index.get(i).size===0&&this._index.delete(i)}warnDocumentChanged(e,t,i){for(let s of Object.keys(this._fieldIds))if(this._fieldIds[s]===t){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(i,'" was not present in field "').concat(s,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}addDocumentId(e){let t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t}addFields(e){for(let t=0;t<e.length;t++)this._fieldIds[e[t]]=t}addFieldLength(e,t,i,s){let n=this._fieldLength.get(e);n==null&&this._fieldLength.set(e,n=[]),n[t]=s;let o=(this._avgFieldLength[t]||0)*i+s;this._avgFieldLength[t]=o/(i+1)}removeFieldLength(e,t,i,s){if(i===1){this._avgFieldLength[t]=0;return}let n=this._avgFieldLength[t]*i-s;this._avgFieldLength[t]=n/(i-1)}saveStoredFields(e,t){let{storeFields:i,extractField:s}=this._options;if(i==null||i.length===0)return;let n=this._storedFields.get(e);n==null&&this._storedFields.set(e,n={});for(let o of i){let l=s(t,o);l!==void 0&&(n[o]=l)}}};h(he,"MiniSearch");var L=he;L.wildcard=Symbol("*");var P=h((r,e)=>Object.prototype.hasOwnProperty.call(r,e)?r[e]:void 0,"getOwnProperty"),Oe={[K]:(r,e)=>{for(let t of e.keys()){let i=r.get(t);if(i==null)r.set(t,e.get(t));else{let{score:s,terms:n,match:o}=e.get(t);i.score=i.score+s,i.match=Object.assign(i.match,o),X(i.terms,n)}}return r},[ce]:(r,e)=>{let t=new Map;for(let i of e.keys()){let s=r.get(i);if(s==null)continue;let{score:n,terms:o,match:l}=e.get(i);X(s.terms,o),t.set(i,{score:s.score+n,terms:s.terms,match:Object.assign(s.match,l)})}return t},[Te]:(r,e)=>{for(let t of e.keys())r.delete(t);return r}},Ve={k:1.2,b:.7,d:.5},De=h((r,e,t,i,s,n)=>{let{k:o,b:l,d:a}=n;return Math.log(1+(t-e+.5)/(e+.5))*(a+r*(o+1)/(r+o*(1-l+l*i/s)))},"calcBM25Score"),je=h(r=>(e,t,i)=>{let s=typeof r.fuzzy=="function"?r.fuzzy(e,t,i):r.fuzzy||!1,n=typeof r.prefix=="function"?r.prefix(e,t,i):r.prefix===!0,o=typeof r.boostTerm=="function"?r.boostTerm(e,t,i):1;return{term:e,fuzzy:s,prefix:n,termBoost:o}},"termToQuerySpec"),N={idField:"id",extractField:h((r,e)=>r[e],"extractField"),tokenize:h(r=>r.split(Be),"tokenize"),processTerm:h(r=>r.toLowerCase(),"processTerm"),fields:void 0,searchOptions:void 0,storeFields:[],logger:h((r,e)=>{typeof(console==null?void 0:console[r])=="function"&&console[r](e)},"logger"),autoVacuum:!0},Z={combineWith:K,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Ve},Ee={combineWith:ce,prefix:h((r,e,t)=>e===t.length-1,"prefix")},Q={batchSize:1e3,batchWait:10},U={minDirtFactor:.1,minDirtCount:20},J=_(_({},Q),U),We=h((r,e)=>{r.includes(e)||r.push(e)},"assignUniqueTerm"),X=h((r,e)=>{for(let t of e)r.includes(t)||r.push(t)},"assignUniqueTerms"),ee=h(({score:r},{score:e})=>e-r,"byScore"),te=h(()=>new Map,"createMap"),k=h(r=>{let e=new Map;for(let t of Object.keys(r))e.set(parseInt(t,10),r[t]);return e},"objectToNumericMap"),M=h(async r=>{let e=new Map,t=0;for(let i of Object.keys(r))e.set(parseInt(i,10),r[i]),++t%1e3===0&&await fe(0);return e},"objectToNumericMapAsync"),fe=h(r=>new Promise(e=>setTimeout(e,r)),"wait"),Be=new RegExp("[\\n\\r\\p{Z}\\p{P}]+","u"),Re=xe(Se(),1),T,G,me,pe=class{constructor(e){Y(this,G),E(this,"mapData"),E(this,"indexes"),E(this,"ready"),Y(this,T),this.mapData=e,this.indexes=_e(e),this.ready=this.populate(),ye(this,T,we(be(this,G,me).bind(this),2e3))}async populate(){let{places:e,enterpriseLocations:t,enterpriseCategories:i}=this.indexes,s=this.mapData,n=[];return e.removeAll(),n=n.concat([e.addAllAsync(s.getByType("space")),e.addAllAsync(s.getByType("point-of-interest")),e.addAllAsync(s.getByType("connection")),e.addAllAsync(s.getByType("floor")),e.addAllAsync(s.getByType("door")),e.addAllAsync(s.getByType("annotation")),e.addAllAsync(s.getByType("area"))]),t&&(t==null||t.removeAll(),n.push(t.addAllAsync(s.getByType("enterprise-location")))),i&&(i==null||i.removeAll(),n.push(i.addAllAsync(s.getByType("enterprise-category")))),Promise.all(n)}async search(e,t={}){var i,s;await this.ready,Pe.parse(t);let n=(0,Re.default)({},t,qe),o=this.indexes.places.search(e,{fields:Object.keys(n.places.fields).filter(u=>n.places.fields[u])});n.places.limit&&(o=o.slice(0,n.places.limit));let l=(i=this.indexes.enterpriseLocations)==null?void 0:i.search(e,{fields:Object.keys(n.enterpriseLocations.fields).filter(u=>n.enterpriseLocations.fields[u])});l&&n.enterpriseLocations.limit&&(l=l.slice(0,n.enterpriseLocations.limit));let a=(s=this.indexes.enterpriseCategories)==null?void 0:s.search(e,{fields:Object.keys(n.enterpriseCategories.fields).filter(u=>n.enterpriseCategories.fields[u])});a&&n.enterpriseCategories.limit&&(a=a.slice(0,n.enterpriseCategories.limit));let d=ge(this.mapData,{placesResult:o,locationsResult:l,categoriesResult:a});return ve(this,T).call(this,e),d}async suggest(e,t={}){await this.ready,Ne.parse(t);let i=[],{places:{enabled:s=!0}={},enterpriseLocations:{enabled:n=!0}={}}=t;return n&&this.indexes.enterpriseLocations&&this.indexes.enterpriseLocations.autoSuggest(e,{fields:["name","tags"],combineWith:"AND",prefix:!0,boost:{name:2,tags:1}}).forEach(o=>i.push(o)),s&&this.indexes.places.autoSuggest(e,{fields:["name"],combineWith:"AND",prefix:!0}).forEach(o=>i.push(o)),i.sort((o,l)=>l.score-o.score),this.mapData.Analytics.capture("$query-suggest",{query:e,suggestions:i.map(o=>o.suggestion)}),i}};T=new WeakMap,G=new WeakSet,me=h(function(r){this.mapData.Analytics.capture("$query-search",{query:r})},"#trackSearch"),h(pe,"InternalSearch");var Ge=pe;function ge(r,{placesResult:e,locationsResult:t,categoriesResult:i}){let s=e.reduce((l,{id:a,match:d,score:u,__type:f})=>{let c=r.getById(f,a);return c!=null&&!ze.is(c)&&!Ie.is(c)&&!Fe.is(c)&&!Ce.is(c)&&!ke.is(c)&&l.push({type:c.__type,match:d,score:u,item:c}),l},[]),n;if(t){n=[];for(let{id:l,match:a,score:d}of t){let u=r.getById("enterprise-location",l);u&&n.push({type:u.__type,match:a,score:d,item:u})}}let o;if(i){o=[];for(let{id:l,match:a,score:d}of i){let u=r.getById("enterprise-category",l);u&&o.push({type:u.__type,match:a,score:d,item:u})}}return{places:s,enterpriseLocations:n,enterpriseCategories:o}}h(ge,"processSearchResult");var qe={places:{fields:{name:!0,description:!0}},enterpriseCategories:{fields:{name:!0,description:!1,"locations.name":!0}},enterpriseLocations:{fields:{name:!0,tags:!0,description:!0}}};function O(r){return r.normalize("NFD").replace(/[\u0300-\u036f|\u2019|\u0027|\']/g,"").toLowerCase()}h(O,"removeAccents");function _e(r){let e=new L({fields:["name","description"],storeFields:["id","__type"],searchOptions:{fuzzy:.2,prefix:!0,boost:{name:2},combineWith:"AND"},extractField:h((o,l)=>{let a=o[l];return typeof a=="string"?O(a):o[l]},"extractField"),processTerm:h(o=>Je.has(o)?"":o.toLowerCase(),"processTerm")}),t=r.getByType("enterprise-location"),i;t&&(i=new L({fields:["name","tags","description"],storeFields:["id","__type"],searchOptions:{combineWith:"OR",prefix:!0,fuzzy:.2,boost:{name:3,tags:2,description:1}},extractField:h((o,l)=>Array.isArray(o[l])?o[l].join(" "):typeof o[l]=="string"?O(o[l]):o[l],"extractField")}));let s=r.getByType("enterprise-category"),n;return s&&(n=new L({fields:["name","description","locations.name"],storeFields:["id","__type"],extractField(o,l){return l==="locations.name"?o.locations.reduce((a,d)=>a+" ".concat(ie," ")+d.name,"")+" ".concat(ie):typeof o[l]=="string"?O(o[l]):o[l]},searchOptions:{combineWith:"OR",prefix:!0,fuzzy:.2,boost:{name:2,"locations.name":2}}})),{enterpriseCategories:n,enterpriseLocations:i,places:e}}h(_e,"buildIndexes");var Pe=y.object({places:y.object({fields:y.object({name:y.boolean().optional(),description:y.boolean().optional()}).optional(),limit:y.number().positive().optional()}).optional(),enterpriseCategories:y.object({fields:y.object({name:y.boolean().optional(),description:y.boolean().optional(),"locations.name":y.boolean().optional()}).optional(),limit:y.number().positive().optional()}).optional(),enterpriseLocations:y.object({fields:y.object({name:y.boolean().optional(),tags:y.boolean().optional(),description:y.boolean().optional()}).optional(),limit:y.number().positive().optional()}).optional()}),Ne=y.object({places:y.object({enabled:y.boolean().optional()}).optional(),enterpriseLocations:y.object({enabled:y.boolean().optional()}).optional()}),Je=new Set(["the","an","and","or","of","in","on","at","to","from","with","by","for"]),ie="";export{Ge as InternalSearch,O as removeAccents};
